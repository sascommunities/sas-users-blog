/* Initialize a CAS session */
cas;

/* Assign all available CAS libraries to the current session */
caslib _all_ assign;

data WORK.WTI_OIL_PRICES;
  infile datalines dsd truncover;
  input DATE:YYMMDD10. price:BEST12.;
  format DATE YYMMDD10. price BEST12.;
datalines4;
2018-03-27,64
2018-03-28,63
2018-03-29,63
2018-03-30,
2018-04-02,62
2018-04-03,62
2018-04-04,62
2018-04-05,62
2018-04-06,61
2018-04-09,62
2018-04-10,64
2018-04-11,65
2018-04-12,66
2018-04-13,66
2018-04-16,65
2018-04-17,65
2018-04-18,67
2018-04-19,67
2018-04-20,67
2018-04-23,66
2018-04-24,66
2018-04-25,67
2018-04-26,67
2018-04-27,67
2018-04-30,67
2018-05-01,66
2018-05-02,66
2018-05-03,67
2018-05-04,68
2018-05-07,69
2018-05-08,67
2018-05-09,70
2018-05-10,70
2018-05-11,69
2018-05-14,70
2018-05-15,70
2018-05-16,70
2018-05-17,70
2018-05-18,70
2018-05-21,71
2018-05-22,71
2018-05-23,70
2018-05-24,69
2018-05-25,66
2018-05-28,
2018-05-29,65
2018-05-30,67
2018-05-31,65
2018-06-01,64
2018-06-04,63
2018-06-05,64
2018-06-06,63
2018-06-07,64
2018-06-08,64
2018-06-11,65
2018-06-12,65
2018-06-13,65
2018-06-14,65
2018-06-15,64
2018-06-18,64
2018-06-19,64
2018-06-20,64
2018-06-21,64
2018-06-22,68
2018-06-25,68
2018-06-26,74
2018-06-27,76
2018-06-28,72
2018-06-29,73
2018-07-02,72
2018-07-03,73
2018-07-04,
2018-07-05,72
2018-07-06,72
2018-07-09,72
2018-07-10,73
2018-07-11,69
2018-07-12,69
2018-07-13,70
2018-07-16,67
2018-07-17,67
2018-07-18,67
2018-07-19,68
2018-07-20,69
2018-07-23,66
2018-07-24,69
2018-07-25,70
2018-07-26,70
2018-07-27,67
2018-07-30,70
2018-07-31,68
2018-08-01,67
2018-08-02,67
2018-08-03,67
2018-08-06,68
2018-08-07,68
2018-08-08,65
2018-08-09,65
2018-08-10,66
2018-08-13,66
2018-08-14,66
2018-08-15,64
2018-08-16,64
2018-08-17,64
2018-08-20,65
2018-08-21,66
2018-08-22,66
2018-08-23,68
2018-08-24,68
2018-08-27,68
2018-08-28,67
2018-08-29,68
2018-08-30,69
2018-08-31,68
2018-09-03,
2018-09-04,68
2018-09-05,67
2018-09-06,66
2018-09-07,66
2018-09-10,66
2018-09-11,68
2018-09-12,69
2018-09-13,67
2018-09-14,67
2018-09-17,67
2018-09-18,68
2018-09-19,70
2018-09-20,69
2018-09-21,69
2018-09-24,72
2018-09-25,72
2018-09-26,71
2018-09-27,71
2018-09-28,72
2018-10-01,74
2018-10-02,74
2018-10-03,75
2018-10-04,73
2018-10-05,73
2018-10-08,73
2018-10-09,73
2018-10-10,72
2018-10-11,69
2018-10-12,70
2018-10-15,70
2018-10-16,70
2018-10-17,68
2018-10-18,67
2018-10-19,68
2018-10-22,68
2018-10-23,65
2018-10-24,65
2018-10-25,66
2018-10-26,66
2018-10-29,66
2018-10-30,65
2018-10-31,64
2018-11-01,62
2018-11-02,62
2018-11-05,62
2018-11-06,61
2018-11-07,60
2018-11-08,59
2018-11-09,59
2018-11-12,58
2018-11-13,54
2018-11-14,55
2018-11-15,55
2018-11-16,55
2018-11-19,56
2018-11-20,52
2018-11-21,53
2018-11-22,
2018-11-23,
2018-11-26,50
2018-11-27,50
2018-11-28,49
2018-11-29,50
2018-11-30,49
2018-12-03,51
2018-12-04,52
2018-12-05,51
2018-12-06,50
2018-12-07,51
2018-12-10,50
2018-12-11,50
2018-12-12,50
2018-12-13,51
2018-12-14,50
2018-12-17,48
2018-12-18,45
2018-12-19,46
2018-12-20,44
2018-12-21,44
2018-12-24,
2018-12-25,
2018-12-26,45
2018-12-27,43
2018-12-28,44
2018-12-31,
2019-01-01,
2019-01-02,45
2019-01-03,45
2019-01-04,46
2019-01-07,47
2019-01-08,48
2019-01-09,51
2019-01-10,51
2019-01-11,50
2019-01-14,49
2019-01-15,50
2019-01-16,51
2019-01-17,50
2019-01-18,52
2019-01-21,
2019-01-22,51
2019-01-23,51
2019-01-24,51
2019-01-25,52
2019-01-28,50
2019-01-29,52
2019-01-30,53
2019-01-31,52
2019-02-01,54
2019-02-04,53
2019-02-05,52
2019-02-06,52
2019-02-07,51
2019-02-08,51
2019-02-11,51
2019-02-12,52
2019-02-13,52
2019-02-14,53
2019-02-15,54
2019-02-18,
2019-02-19,55
2019-02-20,55
2019-02-21,55
2019-02-22,56
2019-02-25,54
2019-02-26,54
2019-02-27,55
2019-02-28,56
2019-03-01,54
2019-03-04,55
2019-03-05,55
2019-03-06,55
2019-03-07,55
2019-03-08,54
2019-03-11,55
2019-03-12,55
2019-03-13,57
2019-03-14,57
2019-03-15,57
2019-03-18,58
2019-03-19,58
2019-03-20,59
2019-03-21,58
2019-03-22,57
2019-03-25,57
2019-03-26,58
2019-03-27,58
2019-03-28,58
2019-03-29,59
2019-04-01,60
2019-04-02,61
2019-04-03,61
2019-04-04,61
2019-04-05,62
2019-04-08,63
2019-04-09,63
2019-04-10,63
2019-04-11,62
2019-04-12,62
2019-04-15,62
2019-04-16,63
2019-04-17,62
2019-04-18,63
2019-04-19,
2019-04-22,64
2019-04-23,65
2019-04-24,64
2019-04-25,64
2019-04-26,62
2019-04-29,62
2019-04-30,62
2019-05-01,62
2019-05-02,60
2019-05-03,60
2019-05-06,61
2019-05-07,60
2019-05-08,61
2019-05-09,60
2019-05-10,60
2019-05-13,59
2019-05-14,60
2019-05-15,61
2019-05-16,61
2019-05-17,61
2019-05-20,62
2019-05-21,62
2019-05-22,60
2019-05-23,56
2019-05-24,57
2019-05-27,
2019-05-28,57
2019-05-29,57
2019-05-30,55
2019-05-31,52
2019-06-03,52
2019-06-04,52
2019-06-05,50
2019-06-06,51
2019-06-07,52
2019-06-10,52
2019-06-11,52
2019-06-12,50
2019-06-13,51
2019-06-14,51
2019-06-17,50
2019-06-18,52
2019-06-19,52
2019-06-20,55
2019-06-21,56
2019-06-24,56
2019-06-25,56
2019-06-26,58
2019-06-27,58
2019-06-28,57
2019-07-01,57
2019-07-02,55
2019-07-03,56
2019-07-04,
2019-07-05,
2019-07-08,56
2019-07-09,56
2019-07-10,59
2019-07-11,58
2019-07-12,58
2019-07-15,58
2019-07-16,56
2019-07-17,55
2019-07-18,54
2019-07-19,54
2019-07-22,54
2019-07-23,55
2019-07-24,54
2019-07-25,54
2019-07-26,55
2019-07-29,55
2019-07-30,57
2019-07-31,57
2019-08-01,52
2019-08-02,54
2019-08-05,53
2019-08-06,52
2019-08-07,50
2019-08-08,51
2019-08-09,53
2019-08-12,53
2019-08-13,56
2019-08-14,54
2019-08-15,53
2019-08-16,53
2019-08-19,55
2019-08-20,55
2019-08-21,54
2019-08-22,54
2019-08-23,53
2019-08-26,52
2019-08-27,53
2019-08-28,54
2019-08-29,55
2019-08-30,54
2019-09-02,
2019-09-03,52
2019-09-04,55
2019-09-05,55
2019-09-06,55
2019-09-09,56
2019-09-10,56
2019-09-11,54
2019-09-12,54
2019-09-13,53
2019-09-16,62
2019-09-17,58
2019-09-18,57
2019-09-19,57
2019-09-20,56
2019-09-23,57
2019-09-24,56
2019-09-25,55
2019-09-26,55
2019-09-27,54
2019-09-30,53
2019-10-01,52
2019-10-02,51
2019-10-03,51
2019-10-04,51
2019-10-07,51
2019-10-08,51
2019-10-09,51
2019-10-10,52
2019-10-11,53
2019-10-14,52
2019-10-15,51
2019-10-16,52
2019-10-17,52
2019-10-18,52
2019-10-21,52
2019-10-22,53
2019-10-23,54
2019-10-24,55
2019-10-25,55
2019-10-28,54
2019-10-29,54
2019-10-30,53
2019-10-31,53
2019-11-01,55
2019-11-04,55
2019-11-05,56
2019-11-06,55
2019-11-07,55
2019-11-08,56
2019-11-11,
2019-11-12,55
2019-11-13,55
2019-11-14,55
2019-11-15,56
2019-11-18,55
2019-11-19,53
2019-11-20,55
2019-11-21,57
2019-11-22,56
2019-11-25,56
2019-11-26,57
2019-11-27,57
2019-11-28,
2019-11-29,57
2019-12-02,54
2019-12-03,55
2019-12-04,57
2019-12-05,57
2019-12-06,58
2019-12-09,57
2019-12-10,58
2019-12-11,57
2019-12-12,58
2019-12-13,59
2019-12-16,59
2019-12-17,59
2019-12-18,59
2019-12-19,60
2019-12-20,59
2019-12-23,59
2019-12-24,60
2019-12-25,
2019-12-26,60
2019-12-27,60
2019-12-30,60
2019-12-31,60
2020-01-01,
2020-01-02,60
2020-01-03,62
2020-01-06,62
2020-01-07,61
2020-01-08,58
2020-01-09,58
2020-01-10,58
2020-01-13,57
2020-01-14,57
2020-01-15,56
2020-01-16,57
2020-01-17,57
2020-01-20,
2020-01-21,57
2020-01-22,55
2020-01-23,54
2020-01-24,53
2020-01-27,52
2020-01-28,52
2020-01-29,52
2020-01-30,51
2020-01-31,50
2020-02-03,49
2020-02-04,48
2020-02-05,49
2020-02-06,49
2020-02-07,49
2020-02-10,48
2020-02-11,49
2020-02-12,50
2020-02-13,50
2020-02-14,51
2020-02-17,
2020-02-18,51
2020-02-19,52
2020-02-20,52
2020-02-21,52
2020-02-24,50
2020-02-25,48
2020-02-26,47
2020-02-27,46
2020-02-28,43
2020-03-02,45
2020-03-03,46
2020-03-04,45
2020-03-05,44
2020-03-06,40
2020-03-09,30
2020-03-10,33
2020-03-11,32
2020-03-12,30
2020-03-13,30
2020-03-16,27
2020-03-17,25
2020-03-18,19
2020-03-19,24
2020-03-20,18
2020-03-23,22
2020-03-24,20
2020-03-25,19
2020-03-26,15
2020-03-27,14
2020-03-30,13
2020-03-31,19
2020-04-01,19
2020-04-02,24
2020-04-03,27
2020-04-06,25
2020-04-07,22
2020-04-08,23
2020-04-09,21
2020-04-10,
2020-04-13,21
2020-04-14,19
2020-04-15,18
2020-04-16,18
2020-04-17,17
2020-04-20,-37
2020-04-21,7
2020-04-22,12
2020-04-23,14
2020-04-24,14
2020-04-27,11
2020-04-28,11
2020-04-29,14
2020-04-30,18
2020-05-01,18
2020-05-04,19
2020-05-05,23
2020-05-06,22
2020-05-07,22
2020-05-08,23
2020-05-11,23
2020-05-12,24
2020-05-13,24
2020-05-14,26
2020-05-15,28
2020-05-18,30
2020-05-19,31
2020-05-20,32
2020-05-21,33
2020-05-22,32
2020-05-25,
2020-05-26,33
2020-05-27,31
2020-05-28,32
2020-05-29,34
2020-06-01,34
2020-06-02,35
2020-06-03,36
2020-06-04,36
2020-06-05,38
2020-06-08,37
2020-06-09,37
2020-06-10,38
2020-06-11,35
2020-06-12,35
2020-06-15,36
2020-06-16,37
2020-06-17,36
2020-06-18,37
2020-06-19,38
2020-06-22,39
2020-06-23,39
2020-06-24,36
2020-06-25,37
2020-06-26,37
2020-06-29,38
2020-06-30,38
2020-07-01,38
2020-07-02,39
2020-07-03,
2020-07-06,39
2020-07-07,39
2020-07-08,39
2020-07-09,38
2020-07-10,39
2020-07-13,39
2020-07-14,39
2020-07-15,40
2020-07-16,39
2020-07-17,39
2020-07-20,39
2020-07-21,40
2020-07-22,40
2020-07-23,39
2020-07-24,40
2020-07-27,40
2020-07-28,39
2020-07-29,40
2020-07-30,38
2020-07-31,39
2020-08-03,39
2020-08-04,40
2020-08-05,41
2020-08-06,40
2020-08-07,40
2020-08-10,40
2020-08-11,40
2020-08-12,41
2020-08-13,41
2020-08-14,41
2020-08-17,41
2020-08-18,41
2020-08-19,41
2020-08-20,41
2020-08-21,41
2020-08-24,41
2020-08-25,42
2020-08-26,42
2020-08-27,41
2020-08-28,41
2020-08-31,41
2020-09-01,41
2020-09-02,41
2020-09-03,40
2020-09-04,38
2020-09-07,
2020-09-08,35
2020-09-09,37
2020-09-10,36
2020-09-11,36
2020-09-14,36
2020-09-15,37
2020-09-16,39
2020-09-17,39
2020-09-18,40
2020-09-21,38
2020-09-22,38
2020-09-23,38
2020-09-24,39
2020-09-25,39
2020-09-28,39
2020-09-29,38
2020-09-30,39
2020-10-01,37
2020-10-02,35
2020-10-05,38
2020-10-06,39
2020-10-07,38
2020-10-08,40
2020-10-09,39
2020-10-12,38
2020-10-13,39
2020-10-14,39
2020-10-15,39
2020-10-16,39
2020-10-19,39
2020-10-20,40
2020-10-21,38
2020-10-22,39
2020-10-23,38
2020-10-26,37
2020-10-27,38
2020-10-28,36
2020-10-29,34
2020-10-30,34
2020-11-02,35
2020-11-03,36
2020-11-04,37
2020-11-05,37
2020-11-06,35
2020-11-09,39
2020-11-10,40
2020-11-11,40
2020-11-12,39
2020-11-13,38
2020-11-16,40
2020-11-17,40
2020-11-18,40
2020-11-19,40
2020-11-20,40
2020-11-23,41
2020-11-24,43
2020-11-25,44
2020-11-26,
2020-11-27,
2020-11-30,44
2020-12-01,43
2020-12-02,44
2020-12-03,44
2020-12-04,45
2020-12-07,44
2020-12-08,44
2020-12-09,44
2020-12-10,45
2020-12-11,45
2020-12-14,46
2020-12-15,46
2020-12-16,46
2020-12-17,47
2020-12-18,48
2020-12-21,46
2020-12-22,46
2020-12-23,46
2020-12-24,47
2020-12-25,
2020-12-28,46
2020-12-29,46
2020-12-30,47
2020-12-31,47
2021-01-01,
2021-01-04,46
2021-01-05,48
2021-01-06,49
2021-01-07,49
2021-01-08,51
2021-01-11,51
2021-01-12,52
2021-01-13,51
2021-01-14,52
2021-01-15,51
2021-01-18,
2021-01-19,51
2021-01-20,52
2021-01-21,52
2021-01-22,51
2021-01-25,51
2021-01-26,51
2021-01-27,51
2021-01-28,51
2021-01-29,51
2021-02-01,52
2021-02-02,53
2021-02-03,54
2021-02-04,55
2021-02-05,55
2021-02-08,56
2021-02-09,57
2021-02-10,57
2021-02-11,57
2021-02-12,58
2021-02-15,
2021-02-16,59
2021-02-17,60
2021-02-18,59
2021-02-19,58
2021-02-22,60
2021-02-23,60
2021-02-24,62
2021-02-25,62
2021-02-26,60
2021-03-01,59
2021-03-02,58
2021-03-03,60
2021-03-04,62
2021-03-05,65
2021-03-08,64
2021-03-09,63
2021-03-10,63
2021-03-11,65
2021-03-12,64
2021-03-15,64
2021-03-16,63
2021-03-17,63
2021-03-18,58
2021-03-19,60
2021-03-22,60
2021-03-23,56
2021-03-24,60
2021-03-25,57
2021-03-26,59
2021-03-29,60
2021-03-30,59
2021-03-31,58
2021-04-01,60
2021-04-02,
2021-04-05,57
2021-04-06,58
2021-04-07,58
2021-04-08,58
2021-04-09,58
2021-04-12,58
2021-04-13,59
2021-04-14,62
2021-04-15,62
2021-04-16,62
2021-04-19,62
2021-04-20,61
2021-04-21,60
2021-04-22,60
2021-04-23,61
2021-04-26,61
2021-04-27,62
2021-04-28,62
2021-04-29,64
2021-04-30,62
2021-05-03,63
2021-05-04,64
2021-05-05,64
2021-05-06,63
2021-05-07,63
2021-05-10,63
2021-05-11,64
2021-05-12,64
2021-05-13,62
2021-05-14,64
2021-05-17,65
2021-05-18,64
2021-05-19,62
2021-05-20,60
2021-05-21,62
2021-05-24,65
2021-05-25,65
2021-05-26,65
2021-05-27,65
2021-05-28,65
2021-05-31,
2021-06-01,66
2021-06-02,67
2021-06-03,67
2021-06-04,68
2021-06-07,68
2021-06-08,69
2021-06-09,68
2021-06-10,69
2021-06-11,70
2021-06-14,69
2021-06-15,71
2021-06-16,71
2021-06-17,70
2021-06-18,70
2021-06-21,72
2021-06-22,72
2021-06-23,72
2021-06-24,72
2021-06-25,73
2021-06-28,71
2021-06-29,72
2021-06-30,72
2021-07-01,74
2021-07-02,74
2021-07-05,
2021-07-06,72
2021-07-07,71
2021-07-08,71
2021-07-09,73
2021-07-12,73
2021-07-13,74
2021-07-14,72
2021-07-15,70
2021-07-16,70
2021-07-19,65
2021-07-20,66
2021-07-21,69
2021-07-22,71
2021-07-23,71
2021-07-26,71
2021-07-27,70
2021-07-28,71
2021-07-29,72
2021-07-30,72
2021-08-02,70
2021-08-03,69
2021-08-04,67
2021-08-05,68
2021-08-06,67
2021-08-09,65
2021-08-10,67
2021-08-11,68
2021-08-12,68
2021-08-13,67
2021-08-16,66
2021-08-17,65
2021-08-18,64
2021-08-19,62
2021-08-20,61
2021-08-23,64
2021-08-24,66
2021-08-25,67
2021-08-26,66
2021-08-27,67
2021-08-30,68
2021-08-31,67
2021-09-01,67
2021-09-02,69
2021-09-03,68
2021-09-06,
2021-09-07,67
2021-09-08,68
2021-09-09,67
2021-09-10,68
2021-09-13,69
2021-09-14,69
2021-09-15,71
2021-09-16,71
2021-09-17,71
2021-09-20,69
2021-09-21,69
2021-09-22,71
2021-09-23,72
2021-09-24,73
2021-09-27,74
2021-09-28,74
2021-09-29,74
2021-09-30,74
2021-10-01,75
2021-10-04,76
2021-10-05,78
2021-10-06,76
2021-10-07,77
2021-10-08,78
2021-10-11,79
2021-10-12,79
2021-10-13,79
2021-10-14,80
2021-10-15,81
2021-10-18,81
2021-10-19,82
2021-10-20,83
2021-10-21,81
2021-10-22,83
2021-10-25,83
2021-10-26,84
2021-10-27,81
2021-10-28,81
2021-10-29,82
2021-11-01,83
2021-11-02,82
2021-11-03,79
2021-11-04,77
2021-11-05,80
2021-11-08,80
2021-11-09,83
2021-11-10,80
2021-11-11,80
2021-11-12,79
2021-11-15,79
2021-11-16,79
2021-11-17,77
2021-11-18,77
2021-11-19,75
2021-11-22,75
2021-11-23,77
2021-11-24,77
2021-11-25,
2021-11-26,
2021-11-29,68
2021-11-30,65
2021-12-01,64
2021-12-02,65
2021-12-03,65
2021-12-06,68
2021-12-07,70
2021-12-08,71
2021-12-09,69
2021-12-10,70
2021-12-13,70
2021-12-14,69
2021-12-15,69
2021-12-16,71
2021-12-17,69
2021-12-20,67
2021-12-21,70
2021-12-22,71
2021-12-23,72
2021-12-24,
2021-12-27,74
2021-12-28,75
2021-12-29,75
2021-12-30,75
2021-12-31,74
2022-01-03,74
2022-01-04,76
2022-01-05,76
2022-01-06,78
2022-01-07,78
2022-01-10,77
2022-01-11,80
2022-01-12,81
2022-01-13,80
2022-01-14,82
2022-01-17,
2022-01-18,84
2022-01-19,85
2022-01-20,85
2022-01-21,84
2022-01-24,83
2022-01-25,85
2022-01-26,87
2022-01-27,86
2022-01-28,86
2022-01-31,88
2022-02-01,87
2022-02-02,87
2022-02-03,89
2022-02-04,91
2022-02-07,90
2022-02-08,88
2022-02-09,88
2022-02-10,88
2022-02-11,92
2022-02-14,94
2022-02-15,91
2022-02-16,92
2022-02-17,90
2022-02-18,90
2022-02-21,
2022-02-22,91
2022-02-23,91
2022-02-24,91
2022-02-25,90
2022-02-28,95
2022-03-01,102
2022-03-02,109
2022-03-03,106
2022-03-04,114
2022-03-07,118
2022-03-08,122
2022-03-09,107
2022-03-10,104
2022-03-11,108
2022-03-14,102
2022-03-15,95
2022-03-16,93
2022-03-17,101
2022-03-18,103
2022-03-21,111
2022-03-22,110
2022-03-23,113
2022-03-24,113
2022-03-25,115
2022-03-28,106
2022-03-29,103
2022-03-30,106
2022-03-31,99
2022-04-01,98
2022-04-04,102
2022-04-05,100
2022-04-06,95
2022-04-07,95
2022-04-08,97
2022-04-11,93
2022-04-12,99
2022-04-13,103
2022-04-14,105
2022-04-15,
2022-04-18,107
2022-04-19,101
2022-04-20,101
2022-04-21,102
2022-04-22,101
2022-04-25,98
2022-04-26,101
2022-04-27,100
2022-04-28,104
2022-04-29,103
2022-05-02,104
2022-05-03,101
2022-05-04,106
2022-05-05,107
2022-05-06,108
2022-05-09,102
2022-05-10,98
2022-05-11,104
2022-05-12,105
2022-05-13,109
2022-05-16,113
2022-05-17,111
2022-05-18,108
2022-05-19,111
2022-05-20,111
2022-05-23,109
2022-05-24,111
2022-05-25,111
2022-05-26,115
2022-05-27,113
2022-05-30,
2022-05-31,113
2022-06-01,114
2022-06-02,115
2022-06-03,117
2022-06-06,117
2022-06-07,118
2022-06-08,120
2022-06-09,120
2022-06-10,119
2022-06-13,119
2022-06-14,117
2022-06-15,114
2022-06-16,116
2022-06-17,108
2022-06-20,
2022-06-21,109
2022-06-22,105
2022-06-23,104
2022-06-24,108
2022-06-27,110
2022-06-28,112
2022-06-29,110
2022-06-30,106
2022-07-01,109
2022-07-04,
2022-07-05,100
2022-07-06,99
2022-07-07,103
2022-07-08,105
2022-07-11,105
2022-07-12,96
2022-07-13,97
2022-07-14,96
2022-07-15,98
2022-07-18,103
2022-07-19,105
2022-07-20,103
2022-07-21,97
2022-07-22,96
2022-07-25,98
2022-07-26,96
2022-07-27,99
2022-07-28,98
2022-07-29,100
2022-08-01,95
2022-08-02,96
2022-08-03,92
2022-08-04,90
2022-08-05,90
2022-08-08,92
2022-08-09,92
2022-08-10,93
2022-08-11,96
2022-08-12,93
2022-08-15,91
2022-08-16,88
2022-08-17,89
2022-08-18,92
2022-08-19,92
2022-08-22,92
2022-08-23,95
2022-08-24,94
2022-08-25,92
2022-08-26,92
2022-08-29,96
2022-08-30,91
2022-08-31,89
2022-09-01,86
2022-09-02,86
2022-09-05,
2022-09-06,86
2022-09-07,81
2022-09-08,83
2022-09-09,86
2022-09-12,87
2022-09-13,86
2022-09-14,87
2022-09-15,84
2022-09-16,84
2022-09-19,85
2022-09-20,83
2022-09-21,82
2022-09-22,83
2022-09-23,78
2022-09-26,76
2022-09-27,77
2022-09-28,81
2022-09-29,80
2022-09-30,78
2022-10-03,83
2022-10-04,85
2022-10-05,87
2022-10-06,87
2022-10-07,92
2022-10-10,90
2022-10-11,88
2022-10-12,86
2022-10-13,88
2022-10-14,85
2022-10-17,85
2022-10-18,82
2022-10-19,85
2022-10-20,85
2022-10-21,84
2022-10-24,85
2022-10-25,85
2022-10-26,88
2022-10-27,88
2022-10-28,86
2022-10-31,85
2022-11-01,87
2022-11-02,89
2022-11-03,87
2022-11-04,91
2022-11-07,90
2022-11-08,87
2022-11-09,84
2022-11-10,85
2022-11-11,88
2022-11-14,84
2022-11-15,85
2022-11-16,84
2022-11-17,80
2022-11-18,79
2022-11-21,78
2022-11-22,79
2022-11-23,76
2022-11-24,
2022-11-25,75
2022-11-28,76
2022-11-29,76
2022-11-30,79
2022-12-01,80
2022-12-02,78
2022-12-05,75
2022-12-06,73
2022-12-07,70
2022-12-08,70
2022-12-09,70
2022-12-12,71
2022-12-13,74
2022-12-14,76
2022-12-15,74
2022-12-16,73
2022-12-19,74
2022-12-20,74
2022-12-21,77
2022-12-22,76
2022-12-23,78
2022-12-26,
2022-12-27,78
2022-12-28,77
2022-12-29,77
2022-12-30,79
2023-01-02,
2023-01-03,75
2023-01-04,71
2023-01-05,72
2023-01-06,72
2023-01-09,73
2023-01-10,74
2023-01-11,76
2023-01-12,77
2023-01-13,78
2023-01-16,
2023-01-17,79
2023-01-18,78
2023-01-19,79
2023-01-20,80
2023-01-23,80
2023-01-24,78
2023-01-25,78
2023-01-26,79
2023-01-27,78
2023-01-30,76
2023-01-31,77
2023-02-01,75
2023-02-02,74
2023-02-03,72
2023-02-06,73
2023-02-07,76
2023-02-08,77
2023-02-09,77
2023-02-10,78
2023-02-13,79
2023-02-14,78
2023-02-15,77
2023-02-16,77
2023-02-17,75
2023-02-20,
2023-02-21,75
2023-02-22,72
2023-02-23,74
2023-02-24,75
2023-02-27,74
2023-02-28,75
2023-03-01,76
2023-03-02,77
2023-03-03,78
2023-03-06,79
2023-03-07,76
2023-03-08,75
2023-03-09,74
2023-03-10,75
2023-03-13,73
2023-03-14,70
2023-03-15,66
2023-03-16,67
2023-03-17,65
2023-03-20,66
2023-03-21,68
2023-03-22,69
2023-03-23,68
2023-03-24,68
2023-03-27,71
;;;;
run;


/* In March 2020 through July 2020, a sell-off in crude began when OPEC failed to strike a deal
   with its allies, led by Russia, about oil production cuts. That, in turn, caused Saudi Arabia
   to slash its oil prices and ramp up production. */

/* Create a new dataset called wti_oil_prices based on the existing dataset */

data wti_oil_prices;
   set wti_oil_prices;
   
   /* Add a new variable 'group' to categorize observations based on the date */
   /* If the date is between March 8, 2020, and July 1, 2020, set group to 1, otherwise set group to 2 */
  
   if "08MAR2020"D<date<="01JUL2020"D then group=1;
   else group=2;
run;

proc sort data=wti_oil_prices;
   by DATE;
run;


/*Plot the oil proce timeseries*/
options orientation = landscape;
ods graphics on / reset width=900px height=600px border=off ANTIALIASMAX=50100;
proc sgplot data=wti_oil_prices;
   scatter x=DATE y=price / group=group transparency=.6;
run;


proc timeseries data = wti_oil_prices out = wti_oil_price_fill;
   id date interval   = day
           accumulate = none
           setmiss    = missing
           format     = date9.;
   var price;
run;

proc expand data=wti_oil_price_fill out=wti_oil_price_fill_int;
   convert price=price_INT / method=join;
   id DATE;
run;

/* Set the output display orientation and enable ODS graphics with specified dimensions and options */
options orientation = portrait;
ods graphics on / reset width=600px height=1000px border=off ANTIALIASMAX=50100;

/*Load the data and run the EMprical Mode Decomposition*/
proc iml;
    /* Read the input data: date and interpolated oil prices */
    use wti_oil_price_fill_int;
    read all var {DATE} into dates;
    read all var {price_INT} into oil_prices;
    close wti_oil_prices_interp;

    /* Perform Empirical Mode Decomposition (EMD) to obtain IMFs and residual */
    optn = {10 10 .01 .001};  
    call EMD(IMF, residual, oil_prices,optn);
    print(IMF);
    title "IMFs of West Texas Intermediate Crude Prices";
    call panelSeries(dates, IMF, {'IMF1','IMF2','IMF3','IMF4','IMF5','IMF6','IMF7'}) grid="y" label={"DATE" "IMF"} NROWS=7;
    ndates=nrow(dates);
    output=shape(1,ndates,10);  
    output[,1]=dates;
    output[,2:8]=IMF;
    output[,9]=oil_prices;
    output[,10]=residual;
    varnames={'DATE' 'IMF1' 'IMF2' 'IMF3' 'IMF4' 'IMF5' 'IMF6' 'IMF7' 'price_INT' 'RESIDUAL'};
    
    /* Create a new dataset with the combined data and IMFs */
    create wti_oil_price_IMF from output[colname=varnames];
    append from output;
    close; 
quit;


data casuser.train
     casuser.test
     train;
   /* Read data from the wti_oil_price_IMF dataset */  
   set wti_oil_price_IMF;
   
   /* Assign a group variable to categorize observations based on the date */
   /* If the date is between March 8, 2020, and July 1, 2020, set group to 1, otherwise set group to 2 */
   
   if "08MAR2020"D<date<="01JUL2020"D then group=1;
   else group=2;
   
   /* Split the data into training and test sets based on the specified date */
   /* If the date is on or before August 31, 2022, output the observation to the training datasets */
   
   
   if DATE le "31AUG2022"D then do;
      output casuser.train;
      output train;
   end; 
   
   /* Otherwise, output the observation to the test dataset */  
   
   else output casuser.test;
run;

%let lead=%sysevalf("27MAR2023"D-"31AUG2022"D);

ods noproctitle;
ods graphics / imagemap=on;
libname _tmpcas_ cas caslib="CASUSER";

proc tsmodel data=CASUSER.TRAIN 
		outobj=(outStat=CASUSER.OUTEST_IMF1(replace=YES) 
		outFcast=_tmpcas_.outFcastTemp(replace=YES) 
		parEst=CASUSER.OUTFOR_IMF1(replace=YES) ) seasonality=7;
	id DATE interval=Day FORMAT=_DATA_ nlformat=YES;
	var IMF1;
	require tsm;
	submit;
	declare object myModel(TSM);
	declare object mySpec(ARIMASpec);
	rc=mySpec.Open();

	/* Specify MA orders. For example: q = (1)(12) */
	array ma[3]/nosymbols;
	ma[1]=1;
	ma[2]=2;
	ma[3]=3;
	rc=mySpec.AddMAPoly(ma);
	rc=mySpec.SetOption('noint', 1);
	rc=mySpec.SetOption('method', 'CLS');
	rc=mySpec.Close();

	/* Setup and run the TSM model object */
	rc=myModel.Initialize(mySpec);
	rc=myModel.SetY(IMF1);
	rc=myModel.SetOption('lead', &lead);
	rc=myModel.SetOption('alpha', 0.05);
	rc=myModel.Run();

	/* Output model forecasts and estimates */
	declare object outFcast(TSMFor);
	rc=outFcast.Collect(myModel);
	declare object parEst(TSMPEst);
	rc=parEst.Collect(myModel);
	declare object outStat(TSMSTAT);
	rc=outStat.Collect(myModel);
	endsubmit;
run;

proc print data=CASUSER.OUTEST_IMF1 label contents="Fit statistics";
	title 'Fit statistics';
run;

ods exclude all;

proc sql;
	select max(DATE) into :maxTimeID from CASUSER.TRAIN;
quit;

ods exclude none;

proc sgplot data=_tmpcas_.outFcastTemp noautolegend 
		description="Predicted and actual values of IMF1";
	title 'Predicted and actual values of IMF1';
	xaxis label='DATE';
	yaxis label='IMF1';
	series x=DATE y=ACTUAL /lineattrs=(color=black) name="actual" 
		legendlabel="Actual";
	series x=DATE y=PREDICT /name="predict" legendlabel="Predicted";
	band x=DATE lower=LOWER upper=UPPER / transparency=0.5 name="pband" 
		legendlabel="95% Confidence Limits";
	refline &maxTimeID /axis=x label="Forecast Start";
run;

proc delete data=_tmpcas_.outFcastTemp;
run;

libname _tmpcas_;